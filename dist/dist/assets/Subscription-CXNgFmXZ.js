import{r as o,d as w,j as e,M as v,P,m as g,A as y}from"./index-cr5avmQX.js";import{P as I,C as S,a as C,E as k,u as f,w as M,b as $}from"./jspdf.plugin.autotable-D91dkI0g.js";import{F as E}from"./index-DaSrO4nm.js";import{t as F}from"./index-Cnhg7C0r.js";import{A as z}from"./index-Cdvyeb2W.js";import"./index-Cn956y_2.js";import"./typeof-QjJsDpFa.js";const A=({onClose:i,invoiceData:m})=>{const[r,h]=o.useState([]),[d,p]=o.useState(!1),c=o.useRef(null);o.useEffect(()=>{j()},[]);const j=async()=>{try{const a=(await w.get(m)).data.sub;h(a)}catch(t){console.log(t)}},N=async()=>{p(!0);try{const t=await F(c.current,{cacheBust:!1}),a=document.createElement("a");a.download="PMC_Invoice.png",a.href=t,a.click(),toast.success("Downloaded")}catch{toast.error("Failed to download invoice")}finally{p(!1)}},x=(t,a)=>{const s=a==="stripe",l=a==="razorpay";return s?`$ ${t}`:l?`₹ ${t}`:`${t}`},u=(t,a)=>{const s=a==="stripe",l=a==="razorpay";return s?`${t} USD`:l?`${t} INR`:`${t}`};return e.jsx(v,{children:e.jsxs("div",{className:"bg-white",children:[r&&e.jsxs("div",{className:"max-w-xl h-auto bg-white py-1 px-2 font-poppins font-extralight",ref:c,children:[e.jsx("span",{className:"flex justify-center my-3",children:e.jsx("img",{src:P,alt:"Image",className:"w-48 "})}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 font-normal",children:[e.jsx("p",{className:"font-normal",children:"Payment Method:"}),e.jsx("p",{children:"Plan:"}),e.jsx("p",{children:"Subscription ID:"}),e.jsx("p",{children:"Customer ID:"}),e.jsx("p",{children:"Amount:"})]}),e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{children:r.method}),e.jsx("p",{children:r.plan}),e.jsx("p",{children:r.subscriberId}),e.jsx("p",{children:"cus_QXoP8hrt4tOqIh"}),e.jsx("p",{children:u(r.amount,r.method)})]})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 font-normal ",children:[e.jsx("p",{children:"Receipt #:"}),e.jsx("p",{children:"Date:"})]}),e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{children:"256746746444"}),e.jsx("p",{children:g(r.date)})]})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3",children:[e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{className:"font-normal",children:"Basic Monthly Plan:"}),e.jsxs("p",{children:["Qty ",r.course]})]}),e.jsx("div",{className:"col-span-6 ",children:e.jsx("p",{children:x(r.amount,r.method)})})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsxs("div",{className:"col-span-6 ",children:[e.jsx("p",{className:"font-normal",children:"Tax:"}),e.jsxs("p",{children:[r.tax,"%"]})]}),e.jsx("div",{className:"col-span-6 ",children:e.jsx("p",{children:r.method==="razorpay"?`₹ ${(Number(r.tax)/100).toFixed(2)}`:`$ ${(Number(r.tax)/100).toFixed(2)}`})})]}),e.jsx("hr",{className:"my-2 mx-5"}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 text-black mx-3 my-3",children:[e.jsx("div",{className:"col-span-6 font-normal",children:e.jsx("p",{children:"Grand Total:"})}),e.jsx("div",{className:"col-span-6 ",children:r.amount&&r.tax&&e.jsx("p",{children:r.method==="razorpay"?`₹ ${(Number(r.amount)+Number(r.tax)/100).toFixed(0)}`:`$ ${(Number(r.amount)+Number(r.tax)/100).toFixed(2)}`})})]})]}),e.jsxs("div",{className:"flex justify-evenly items-center my-8 ",children:[e.jsx("p",{onClick:i,className:" cursor-pointer text-lg  bg-white  border-2 border-black text-center text-black px-10 py-2.5  ",children:"Cancel"}),e.jsx("button",{className:`text-lg  bg-gradient-to-r from-[#3D03FA] to-[#A71CD2] w-52 py-2.5 ${d?"opacity-15":""}`,disabled:d,onClick:N,children:d?e.jsxs("span",{className:"flex justify-center gap-3",children:[" ",e.jsx(z,{className:"h-6 w-6 animate-spin"})," ",e.jsx("p",{children:"Downloading ...."})]}):"Download Invoice"})]})]})})},O=({permissions:i})=>{const m=i==null?void 0:i.includes("view"),[r,h]=o.useState(!1),[d,p]=o.useState({}),[c,j]=o.useState([]);o.useEffect(()=>{N()},[]);const N=async()=>{try{const l=(await w.get(`${y}/api/getallsubs`)).data.sub;j(l)}catch(s){console.log(s)}},x=()=>c.map(s=>({"User Id":s._id,"First Name":s.fname,"Last Name":s.lname,Email:s.email,Phone:s.phone,Date:g(s.date),Plan:s.plan,Amount:s.amount,Transaction:s.subscriberId,"Payment Mode":s.method})),u=()=>{const s=f.json_to_sheet(x()),l=[{wpx:180},{wpx:100},{wpx:100},{wpx:180},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80},{wpx:80}];s["!cols"]=l;const b=f.book_new();f.book_append_sheet(b,s,"subscription"),M(b,"PMC Subscription.xlsx")},t=()=>{const s=new $,l=["User Id","First Name","Last Name","Email","Phone","Date","Plan","Amount","Transaction","Payment Mode"],b=x().map(n=>[n["User Id"],n["First Name"],n["Last Name"],n.Email,n.Phone,n.Date,n.Plan,n.Amount,n.Transaction,n["Payment Mode"]]);s.autoTable({head:[l],body:b,startY:20,theme:"grid",headStyles:{fillColor:[97,144,213],textColor:[255,255,255],fontStyle:"bold",halign:"center"},bodyStyles:{textColor:[0,0,0],halign:"center"}}),s.save("PMC_Subscription.pdf")},a=s=>{p(`${y}/api/getsubonid/${s}`),h(!0)};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:" font-extralight",children:[e.jsxs("div",{className:"flex justify-between items-center my-2",children:[e.jsx("p",{className:" mx-2 mt-6",children:"Subscription"}),e.jsxs("div",{className:" mx-2 flex gap-6 mt-4",children:[e.jsx("button",{onClick:t,children:e.jsx("img",{className:"size-8",src:I,alt:"Pdf image"})}),e.jsx(S,{data:x(),filename:"PMC_Subscription.csv",className:"cursor-pointer",target:"_blank",children:e.jsx("img",{className:"size-8",src:C,alt:"csv image"})}),e.jsx("button",{onClick:u,children:e.jsx("img",{className:" size-8",src:k,alt:"excel image"})})]})]}),e.jsx("div",{className:"mx-1 overflow-auto no-scrollbar ",children:e.jsxs("table",{className:"  w-full",children:[e.jsx("thead",{className:"text-slate-300 ",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 font-extralight border border-slate-400",children:"User Id"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"First Name"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"Last Name"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Email"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Phone"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Date"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Plan"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Amount"}),e.jsx("th",{className:"font-extralight border border-slate-400",children:"Transaction id"}),e.jsx("th",{className:"font-extralight border border-slate-400 text-nowrap",children:"Payment Mode"}),m&&e.jsx("th",{className:"font-extralight border border-slate-400",children:"Action"})]})}),e.jsx("tbody",{className:"text-slate-400  ",children:c&&c.map((s,l)=>e.jsxs("tr",{className:" text-nowrap text-center",children:[e.jsx("td",{className:"border border-slate-400  ",children:s._id}),e.jsxs("td",{className:"border border-slate-400 capitalize ",children:[s.fname," "]}),e.jsx("td",{className:"border border-slate-400 capitalize ",children:s.lname}),e.jsx("td",{className:"border border-slate-400",children:s.email}),e.jsx("td",{className:"border border-slate-400",children:s.phone}),e.jsx("td",{className:"border border-slate-400",children:g(s.date)}),e.jsxs("td",{className:"border border-slate-400 px-2 capitalize ",children:[" ",s.plan]}),e.jsx("td",{className:"border border-slate-400 ",children:s.amount}),e.jsx("td",{className:"border border-slate-400 ",children:s.subscriberId}),e.jsx("td",{className:"border border-slate-400 capitalize",children:s.method}),e.jsx("td",{className:" border-b border-r border-slate-400 flex  justify-center items-center  ",children:m&&e.jsx("p",{onClick:()=>a(s._id),className:" cursor-pointer p-2  text-green-600 ",children:e.jsx(E,{size:24})})})]},l))})]})})]}),r&&e.jsx(A,{onClose:()=>h(),invoiceData:d})]})};export{O as default};
